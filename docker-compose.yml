version: '3.9'

# ============================================================
# docker-compose.yml — MédiSym
# ============================================================
# Démarrage rapide :
#   docker-compose up -d --build
#
# Accès : http://localhost:5000
# Admin : admin@medisym.com / Admin@1234
# ============================================================

services:
  web:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: medisym_app
    ports:
      - "${PORT:-5000}:5000"
    environment:
      - SECRET_KEY=${SECRET_KEY:-medisym-change-this-secret-key-in-production}
      - DATABASE_URL=sqlite:////app/instance/medisym.db
      - FLASK_ENV=${FLASK_ENV:-production}
    volumes:
      # Persistance de la base de données SQLite
      - medisym_data:/app/instance
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5000/"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 15s
    networks:
      - medisym_network

# ============================================================
# Pour utiliser PostgreSQL (optionnel, production recommandée)
# Décommentez ce bloc et modifiez DATABASE_URL
# ============================================================
# db:
#   image: postgres:15-alpine
#   container_name: medisym_db
#   environment:
#     POSTGRES_DB: medisym
#     POSTGRES_USER: medisym_user
#     POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-medisym_password}
#   volumes:
#     - postgres_data:/var/lib/postgresql/data
#   networks:
#     - medisym_network
#   healthcheck:
#     test: ["CMD-SHELL", "pg_isready -U medisym_user -d medisym"]
#     interval: 10s
#     timeout: 5s
#     retries: 5

volumes:
  medisym_data:
    driver: local
  # postgres_data:
  #   driver: local

networks:
  medisym_network:
    driver: bridge
